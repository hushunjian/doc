# 王国Extra信息白皮书

## 历史
|时间|修订人|版本|描述|
|:----|:--------|:--------|:----|
|2016/10/24|陈建文|1 |创建文档，增加文字at类型、音频信息类型、视频信息类型以及图片信息类型数据定义。|
|2016/10/25|陈建文|2 |修改图片信息格式定义为mime类型。|
|2016/11/28|陈建文|3 |历史段落移到尾页；<br/> 修改图片文件尺寸、类型和旋转信息定义；<br/> 补全公共信息type字段定义；<br/> 增加公共信息only创建唯一识别字段。|
|2016/12/06|陈建文|4 |"添加版本控制信息；<br/> 添加王国跳转信息。|
|2016/12/09|陈建文|5 |添加王国跳转链接信息；<br/> 添加王国高级系统信息定义。|
|2017/01/10|陈建文|6 |添加基础类型表述；<br/> 添加文字类型信息。|
|2017/01/12|陈建文|7 |修正文字类型表述。|
|2017/01/20|陈建文|8 |修改王国跳转类型为内链跳转类型|
|2017/01/22|陈建文|9 |添加来源信息；<br/> 格式化文档|
|2017/02/05|陈建文|10|修正内链类型描述错误(kingdom -> link)；<br/> 补全内链中聚合王国类型索引值。|
|2017/02/05|陈建文|11|内链信息中增加作者身份字段|
|2017/02/06|陈建文|12|内链信息中增加封面字段|
|2017/02/07|陈建文|13|添加行为索引字段；<br/> 在基础类型中添加来源信息对象|
|2017/02/21|陈建文|14|添加linkextra标签记录字段|
|2017/02/22|陈建文|15|添加linkextra行为索引——转发|
|2017/03/16|陈建文|16|移除了高级系统信息的描述；<br/> 新增系统信息类型；<br/> 新增足迹信息类型"|
|2017/04/20|陈建文|17|新增表情信息段落|
|2017/05/05|陈建文|18|添加文本信息（包括At）水平对齐信息；<br/> 添加“逗一逗”信息；<br/> 添加投票信息|
|2017/05/19|陈建文|19|添加链接下发类型；<br/> 添加“逗一逗”被逗人名称字段"|
|2017/06/06|陈建文|20|添加王国所有权转让证书类型；|
|2017/07/24|陈建文|21|添加图片extra定义，增加对“日签”图片的区分。|
|2017/08/01|陈建文|22|添加“记录信息”定义；<br/> 添加“抽奖信息”定义"|
|2017/08/12|陈建文|23|添加“记录信息”图片数据信息定义|
|2017/08/23|陈建文|24|增加抽奖方图适配；|
|2017/08/30|陈建文|25|增加礼物数据定义；<br/> 增加排版图组数据定义；<br/> 增加文本大小属性定义；|
|2017/08/31|陈建文|26|增加头像框数据定义|
|2017/09/07|陈建文|27|在链接定义中增加内容文字字段content|
|2017/09/12|陈建文|28|礼物数据补充id字段|
|2017/10/27|陈建文|29|增加排版图组作为日签数据时的定义|

## 概述
### 本文档包含了王国详情设计中，由客户端发起的数据协议。包括了存储在详情信息的fragment字段中的特殊协议和extra字段中的信息。
### 目前含有特殊协议的数据类型包括了文字at类型、音频信息类型、视频信息类型以及图片信息类型等。以下会对各种类型的特殊协议进行逐个说明。

## 基础类型
### 基础类型是指所有extra信息中都会包含的基础信息。从技术上来讲，所有其他类型的extra信息是这个类型的子类。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|"extra的类型<br/> textNormal	普通文本类型<br/> text	带有at文本类型<br/> audio	音频信息<br/> video	视频信息<br/> image	图片信息<br/> kingdom	王国信息|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|

### 文字类型
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为textNormal|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|hAlign|文本|"文字水平对齐方式，具体如下<br/> start	左对齐<br/> center	居中<br/> end	右对齐<br/> |
|size|32位整型|文字尺寸|

### 文字at类型
#### 文字at类型是用于记录文字和at人信息的一种类型。它的结构如下：
#### 文字at类型的数据存储在详情信息的fragment字段中。值得注意的是，由于历史的设计原因，版本1的数据中并没有存储atUid，这就导致了旧版本的数据需要根据其详情数据的atUid来完成对at对象的解析。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为text|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|hAlign|文本|"文字水平对齐方式，具体如下<br/> start	左对齐<br/> center	居中<br/> end	右对齐|
|text|文本|带有at内容的文字主体。|
|atStart|32位整型|at对象相对于整个at内容的文字开始索引。|
|atEnd|32位整型|at对象相对于整个at内容的文字结束索引。(atEnd = atStart + length)|
|atUid|64位整型|at对象（用户）的唯一索引。|
|array|数组类型|有多对象at时，array中存储多个对象的索引信息。每个对象都包括atStart、atEnd和atUid，具体可参考以上描述。array中第一条at对象信息与array外部的at对象信息保持一致。只有一个at对象时，这个数据可以为空。|
|size|32位整型|文字尺寸|

### 音频信息类型
#### 音频信息包括了音频在七牛运存储上的关键字名以及音频的播放长度。
#### 音信信息类型亦存储于详情信息的fragment字段中。为了方便数据处理，音频信息也可以通过详情信息中的fragmentImage获取完整文件存储路径。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为audio|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|key|文本|七牛云存储上的文件名|
|duration|64位整型|音频的播放长度，以毫秒为单位|

### 视频信息类型
#### 视频信息包括了视频的播放长度和文件尺寸。以下是具体说明。
#### 视频信息类型存储与详情信息的extra字段。视频的缩略图存储在详情信息的fragmentImage字段中；视频信息的文件路径存储在详情信息的fragment字段中。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为video|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|duration|64位整型|播放长度，以毫秒为单位|
|length|64位整型|文件大小，以Byte为单位|

### 图片信息类型
#### 图片信息包括了图片的基本信息。以下是具体说明
#### 图片信息类型存储与详情信息的extra字段。图片文件路径存储在详情信息的fragmentImage字段中。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，如果为普通图片则此处为image；如果为日签图片则此处为image_daycard。|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|w|32位整型|图片宽度|
|h|32位整型|图片高度|
|length|64位整型|原始文件大小，以Byte为单位|
|orientation|32位整型|"原始文件Exif中定义的旋转方式。<br/> 2：水平翻转<br/> 4：垂直翻转<br/> 1：正常（无变化）<br/> 3：顺时针旋转180度<br/> 8：顺时针旋转270度<br/> 6：顺时针旋转90度<br/> 5：水平翻转然后顺时针旋转270度<br/> 7：水平翻转然后顺时针旋转90度<br/> 0：无旋转信息（无变化）"|
|format|文本|原始格式信息，参考mime类型定义 |
|rLen|64位整型|实际文件大小，以Byte为单位|
|rFmt|文本|实际文件格式信息，参考mime类型定义|

### 内链跳转信息类型
#### 跳转信息包含了跳转到指定王国的基本信息。具体参考下表。
#### 标题信息也会存在fragment字段中；在fragmentImage中也会存储王国图片封面信息。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为link|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|id|64位整型|唯一索引号。<br/> 王国	王国id<br/> UGC	内容id<br/> PGC	内容id<br/> 活动	0<br/> 智能推荐	内容id|
|cid|64位整型|唯一索引号。<br/> 王国	王国内容id<br/> UGC	同id<br/> PGC	同id<br/> 活动	同id<br/> 智能推荐	同id|
|uid|64位整型|内容作者唯一索引号|
|title|文本|标题|
|subType|32位整型|子类型<br/> 王国	普通王国	0<br/> 7天单人王国	1<br/> 7天双人王国	2<br/> 春节王国	3<br/> 聚合王国	1000<br/> UGC	无子类型<br/> PGC	无子类型<br/> 活动	普通活动	0<br/> 高级活动	1<br/> 智能推荐	文章	0<br/> 音乐	1<br/> 视频	2<br/> 行为建议	3<br/> 系统推荐	4<br/> 社会推荐	5<br/> 测试	6<br/> UGC推荐	7<br/> 王国推荐	8|
|avatar|文本|作者头像|
|createTime|64位整型|创建时间|
|url|文本|内容网页地址<br/> 王国	分享地址<br/> UGC	分享地址<br/> PGC	分享地址<br/> 活动	网页原文地址<br/> 智能推荐	网页原文地址|
|v_lv|32位整型|作者身份|
|name|文本|作者昵称|
|cover|文本|封面|
|action|32位整型|行为索引<br/> 索引	行为<br/> 0	无行为（不显示）<br/> 1	收录 （显示‘收录’）<br/> 2	被收录（显示‘收录了你’）<br/> 3	转发（显示‘转发了’）<br/> 4	下发（显示‘下发了’）|
|tag|文本|存储标签信息，使用封号作为分割符号。|
|avatarFrame|文本|作者头像框|
|content|文本|内容文字信息|

### 足迹类型信息
#### 足迹信息是由用户进行串门操作产生的信息。具体结构如下，
#### 足迹信息的文本内容context也会保存在fragment字段中。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为footmark|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|content|文本|内容文本|
|emoji|文本|表情图片网络地址|


### 系统信息
#### 系统信息只能由系统发出。具体结构参考下表。
#### 系统信息的文本信息内容content也会保存存在fragment字段中。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为system|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|content|文本|内容文本|
|linkType|32位整型|类型索引<br/> 索引	命名	说明<br/> 0	TYPE_MESSAGE	纯文本<br/> 70	TYPE_UGC	用户发布短文<br/> 71	TYPE_PGC	运营发布短文<br/> 72	TYPE_KINGDOM	王国<br/> 73	TYPE_ACTIVITY	活动<br/> 74	TYPE_PPGC	智能推荐|
|link|链接|连接信息。具体请查考内链跳转信息类型段落。<br/> 数据中的only值和from值失效，无需关心。|
|linkColor|文本|标准色彩定义(#aarrggbb, #rrggbb, #rgb)|
|linkStart|32位整型|链接对象相对于整个内容的文字开始索引。|
|linkEnd|32位整型|链接对象相对于整个内容的文字结束索引。|

### 表情信息
#### 用户发出的特殊表情信息如下。
#### 表情信息理论上不占用王国信息的fragment和fragmentImage字段。不过，考虑到效率，推荐在数据本地化的时候，将内容文本放入fragment字段中，将表情图放入fragmentImage字段。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为emoji|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|tite|文本|表情标题|
|content|文本|内容文本|
|emojiType|32位整型|类型索引<br/> 索引	命名	说明<br/> 0	EMOJI_TYPE_NORMAL	普通表情<br/> 1	EMOJI_TYPE_LARGE	大表情<br/> |
|image|文本|表情图，在展示表情时使用|
|w|32位整型|表情图片宽度|
|h|32位整型|表情图片高度|
|thumb|文本|缩略图，在表情选择框中使用|
|thumb_w|32位整型|表情缩略图宽度|
|thumb_h|32位整型|表情缩略图高度|
|packageId|文本|表情包索引|
|packageName|文本|表情包名|
|packageCover|文本|表情包封面|

### “逗一逗”信息
#### 用户进行“逗一逗”操作发出信息如下，
#### “逗一逗”功能采用原先完全随机的方式呈现，因此数据段中不保留任何相关信息。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为fun|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|avatar|文本|被逗人的头像|
|uid|64位整型|被逗人的唯一号|
|name|文本|被逗人的名字|
|avatarFrame|文本|被逗人头像框|

### 投票信息
#### 用户投票单元信息如下。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为vote|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|title|文本|投票标题|
|id|64位整型|投票唯一号，用于索引投票具体信息。|

### 抽奖信息
#### 用户抽奖单元信息如下。
#### 抽奖信息的图片存放在fragmentImage字段中；
#### 抽奖信息的文本标题存放在fragment字段中。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为raffle|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|id|64位整型|抽奖唯一号，用于索引抽奖具体信息。|
|imageSq|文本|方形抽奖图片存放地址。|

### 礼物
#### 用户进行送礼物操作发出信息如下，
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为fun|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|id|文本|礼物识别号|
|image|文本|礼物图片|
|count|64位整型|礼物数量|
|name|文本|礼物名称|
|w|32位整型|图片宽度|
|h|32位整型|图片高度|

### 记录信息
#### 用户记录单元信息如下。
#### 记录信息的图片（封面图）存放在fragmentImage字段中；
#### 记录信息的文本标题存放在fragment字段中。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为ugc|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|content|文本|记录信息的文本内容。|
|images|数组类型|包含多张图片的网络地址。（除封面图）|
|imageInfo|数组类型|包含多张图片的信息。可选信息，具体参考图片信息类型段落。|

### 排版图组
#### 排版图组单元信息如下。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为imageSet。如果为日签图组则为imageSetDaycard。|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|content|文本|记录信息的文本内容。|
|images|数组类型|包含多张图片的网络地址。|
|imageInfo|数组类型|包含多张图片的信息。可选信息，具体参考图片信息类型段落。|
|hAlign|文本|图组水平对齐方式，具体如下<br/> start	左对齐<br/> center	居中<br/> end	右对齐|

### 王国所有权转让证书信息
#### 王国所有权转让证书（以下称转让证）包含如下几项信息元素。
#### 转让证中，转让日期存储在王国详情数据记录的createTime字段中。
#### 下图是转让证的实现样式。
|字段|类型|含义|
|:-----|:-----|:----| 
|type|文本|extra的类型，此处一定为kingdomOTD|
|only|文本|创建唯一识别信息，配合uid用于识别信息|
|from|来源|该信息指出分发的来源。具体参考来源信息段落。|
|price|64位整型|转让价格|
|uid|64位整型|新国王唯一识别号|
|avatar|文本|新国王头像|
|name|文本|新国王名字|
|oldUid|64位整型|旧国王唯一识别号|
|oldAvatar|文本|旧国王头像|
|oldName|文本|旧国王头像|
|oldAvatarFrame|文本|旧国王头像|
|avatarFrame|文本|新国王头像框|

### 来源信息
#### 来源信息存在在所有跨王国转发信息中。理论上，除了系统信息以外，所有其他类型的跨王国信息都存在来源信息。来源信息会做为其他信息的一部分存在在extra中，专用名称为from。以下是来源信息的内部结构。
|字段|类型|含义|
|:-----|:-----|:----| 
|uid|64位整型|来源用户id|
|avatar|文本|来源用户头像|
|id|64位整型|来源王国id|
|cid|64位整型|来源王国cid|
|url|文本|网页跳转地址|
|title|文本|来源王国标题|
|cover|文本|来源王国封面|
|avatarFrame|文本|来源用户头像框|
